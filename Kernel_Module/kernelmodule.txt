1Ô∏è‚É£ What is a Kernel Module?

A Kernel Module is a piece of code that can be dynamically loaded into or removed from the Linux kernel at runtime.

Instead of rebuilding the entire kernel, we load modules when needed.

Common uses:

Device drivers (UART, SPI, I2C, GPIO, etc.)

Filesystem support

Network protocols

Debug/testing modules

In embedded systems (like STM32 Linux boards, BeagleBone, Raspberry Pi), most hardware drivers are kernel modules.


2Ô∏è‚É£ First Linux Device Driver

A Linux device driver is simply a kernel module that controls hardware.

Your first driver usually:

Loads into kernel

Prints a message

Unloads safely

This is called the Hello World Kernel Module.



3Ô∏è‚É£ Module Information Macros

These macros describe the module metadata.

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Komal");
MODULE_DESCRIPTION("Simple Hello World Driver");
MODULE_VERSION("1.0");

üîπ MODULE_LICENSE

Defines license type.

"GPL" ‚Üí No kernel taint

If not GPL ‚Üí Kernel becomes "tainted"

üîπ MODULE_AUTHOR

Developer name.

üîπ MODULE_DESCRIPTION

Short info about module.

üîπ MODULE_VERSION

Version number.



4Ô∏è‚É£ Simple Kernel Module Programming Structure

Every kernel module has:

Header files

Init function

Exit function

Module macros

Basic structure:

#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/init.h>

static int __init hello_init(void)
{
    printk(KERN_INFO "Hello: Module Loaded\n");
    return 0;
}

static void __exit hello_exit(void)
{
    printk(KERN_INFO "Hello: Module Removed\n");
}

module_init(hello_init);
module_exit(hello_exit);

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Komal");
MODULE_DESCRIPTION("Simple Hello World Driver");
MODULE_VERSION("1.0");

5Ô∏è‚É£ Init Function
static int __init hello_init(void)


Runs when module is inserted

Must return 0 if success

__init ‚Üí Frees memory after loading

6Ô∏è‚É£ Exit Function
static void __exit hello_exit(void)


Runs when module is removed

Used to free memory / release devices

7Ô∏è‚É£ printk()

printk() is the kernel version of printf().

Example:

printk(KERN_INFO "Message\n");

Log Levels
Level	Meaning
KERN_ALERT	Critical error
KERN_ERR	Error
KERN_WARNING	Warning
KERN_INFO	Information
KERN_DEBUG	Debug
8Ô∏è‚É£ Difference Between printf and printk
Feature	printf	printk
Used in	User space	Kernel space
Header	stdio.h	linux/kernel.h
Output location	Terminal	Kernel log buffer
View output	Directly printed	dmesg command
Log levels	No	Yes

You cannot use printf in kernel module.

9Ô∏è‚É£ Compiling Our Driver

You must use the kernel build system.

Step 1: Create hello.c

Save the code above as:

hello.c

Step 2: Create Makefile
obj-m += hello.o

all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean

Step 3: Compile
make


Output file:

hello.ko


.ko ‚Üí Kernel Object file

üîü Loading and Unloading Linux Device Driver
‚úÖ Loading
sudo insmod hello.ko


Check logs:

dmesg

‚úÖ Listing the Modules
lsmod


To filter:

lsmod | grep hello

‚úÖ Unloading
sudo rmmod hello


Check logs:

dmesg



